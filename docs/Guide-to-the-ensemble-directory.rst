.. _Guide to the Ensemble Directory:

The structure of the ensemble directory
==========

.. _Template:

The Template Run Directory
-------------

The CHEEREIO Template Run directory is essentially a standard GEOS-Chem run directory, generated by a routine within the ``setup_ensemble.sh`` script that is very much like the code that generates the standard GEOS-Chem run directory, though there are a few minor differences. This directory will then be copied by  ``setup_ensemble.sh`` to form the Spinup Run directory and the individual ensemble members within the Ensemble Runs directory. Users should make sure that the Template Run directory meets all their requirements before any further copying takes place. 

Differences are as follows. ``input.geos`` has empty tags for the start and end times, as this will allow CHEEREIO to resubmit GEOS-Chem runs for different time periods. ``HEMCO_Config.rc`` is represented by two template files. ``HEMCO_Config_SPINUP_NATURE_TEMPLATE.rc`` is for spinup and "nature" simulations, neither of which include randomized scaling factors (i.e. it is a normal HEMCO_Config.rc file generated by the usual run directory creation script). ``HEMCO_Config.rc`` is for ensemble members, all of whom will have perturbed emissions. References to gridded scaling factors are added at key lines in this config file. Finally, the template run directory has no batch script associated with it, as it cannot be run.

Although ``HEMCO_Config.rc`` is generated by the ``setup_ensemble.sh`` utility, it may not be automatically ready to use if you are distinguishing your updates of different emissions sources of one species (for example, updating NO agricultural emissions separately from the rest of NO emissions). CHEEREIO is not capable of distinguishing these emissions on its own. Instead, it will just add scaling factor references wherever the species of interest emerges. The user must delete the correct duplicated scaling factor references manually.

Aside from these subtleties, the user should modify the template run directory as freely as they would any GEOS-Chem run directory they are customizing for their own research.

The Spinup Run Directory
-------------

The Spinup Run directory, if it is enabled, functions like a normal GEOS-Chem run directory. Created by the ``setup_ensemble.sh``, it comes with a run script and with all the configuration files set according to your specifications in ``ens_config.json``. When the Spinup Run terminates, the restart file generated will automatically be used to initialize the ensemble run directories. No copying on the user's part is necessary.


The scratch directory
-------------

TKTKTK

The Ensemble Runs Directory
-------------

TKTKTK
